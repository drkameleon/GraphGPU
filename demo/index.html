<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>graphGPU — Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/phosphor-icons"></script>
  <style>
    :root {
      --bg: #1e1f26;
      --bg-darker: #181920;
      --bg-surface: #252630;
      --bg-elevated: #2c2d3a;
      --border: #363744;
      --border-subtle: #2e2f3c;
      --text: #d8d6e0;
      --text-dim: #8a889a;
      --text-muted: #555466;
      --accent: #7c6ff7;
      --accent-soft: rgba(124, 111, 247, 0.12);
      --green: #4caf7c;
      --green-soft: rgba(76, 175, 124, 0.12);
      --red: #c0392b;
      --red-soft: rgba(192, 57, 43, 0.12);
      --yellow: #e2b93d;
      --font: 'Source Sans 3', 'Source Sans Pro', sans-serif;
      --mono: 'Fira Code', monospace;
      --statusbar-h: 34px;
      --toolbar-h: 42px;
      --radius: 6px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font);
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      -webkit-user-select: none;
      user-select: none;
    }

    /* ========= TOOLBAR ========= */
    .toolbar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--toolbar-h);
      background: var(--bg-darker);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 12px;
      z-index: 20;
      gap: 2px;
    }

    .toolbar .brand {
      font-family: var(--mono);
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      letter-spacing: -0.3px;
      margin-right: 16px;
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .toolbar .brand .dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 6px var(--accent);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .toolbar .sep {
      width: 1px;
      height: 20px;
      background: var(--border);
      margin: 0 8px;
    }

    .toolbar .btn {
      font-family: var(--font);
      font-size: 12px;
      font-weight: 500;
      padding: 4px 10px;
      border: 1px solid transparent;
      border-radius: var(--radius);
      background: transparent;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.12s;
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    .toolbar .btn i { font-size: 14px; }

    .toolbar .btn:hover {
      background: var(--bg-elevated);
      color: var(--text);
      border-color: var(--border);
    }

    .toolbar .btn.active {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: var(--accent);
    }

    .toolbar .spacer { flex: 1; }

    .toolbar .stats {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--text-muted);
    }

    .toolbar .stats b {
      color: var(--text-dim);
      font-weight: 500;
    }

    /* ========= CANVAS ========= */
    #graph-canvas {
      position: fixed;
      top: var(--toolbar-h);
      left: 0; right: 0;
      bottom: var(--statusbar-h);
      width: 100%;
      height: calc(100vh - var(--toolbar-h) - var(--statusbar-h));
      cursor: grab;
    }

    #graph-canvas:active { cursor: grabbing; }

    /* ========= CONTEXT PANEL ========= */
    .context-panel {
      position: fixed;
      top: calc(var(--toolbar-h) + 12px);
      right: 12px;
      z-index: 15;
      display: flex;
      flex-direction: column;
      gap: 6px;
      transition: opacity 0.2s, transform 0.2s;
    }

    .context-panel.hidden {
      opacity: 0;
      transform: translateX(20px);
      pointer-events: none;
    }

    .ctx-btn {
      width: 36px; height: 36px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: var(--bg-surface);
      color: var(--text-dim);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.15s;
    }

    .ctx-btn:hover {
      border-color: var(--text-dim);
      color: var(--text);
      background: var(--bg-elevated);
    }

    .ctx-btn.green:hover { border-color: var(--green); color: var(--green); }
    .ctx-btn.red:hover { border-color: var(--red); color: var(--red); }

    .ctx-sep {
      width: 18px;
      height: 0;
      border-top: 2px dotted var(--border);
      margin: 2px auto;
    }

    /* ========= PALETTE BAR ========= */
    .palette-bar {
      position: fixed;
      top: 50%;
      left: 12px;
      transform: translateY(-50%);
      z-index: 15;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .palette-swatch {
      width: 18px; height: 18px;
      border-radius: 4px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.12s;
      opacity: 0.4;
    }

    .palette-swatch:hover { opacity: 0.9; transform: scale(1.15); }
    .palette-swatch.active { border-color: var(--text); opacity: 1; }

    /* ========= STATUS BAR ========= */
    .statusbar {
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      height: var(--statusbar-h);
      background: var(--bg-darker);
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 14px;
      z-index: 20;
      font-size: 12px;
      color: var(--text-dim);
      gap: 6px;
      overflow: hidden;
    }

    .statusbar .tag {
      font-family: var(--mono);
      font-size: 10px;
      font-weight: 600;
      padding: 1px 7px;
      border-radius: 3px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #fff;
      flex-shrink: 0;
    }

    .statusbar .props {
      display: flex;
      gap: 4px;
      overflow: hidden;
      flex: 1;
    }

    .statusbar .prop {
      display: flex;
      gap: 3px;
      white-space: nowrap;
      align-items: center;
    }

    .statusbar .prop::before {
      content: '⁞';
      color: var(--text-muted);
      margin-right: 2px;
    }

    .statusbar .prop:first-child::before { display: none; }

    .statusbar .prop b {
      font-weight: 600;
      font-size: 11px;
      color: var(--text-dim);
    }

    .statusbar .prop span { color: var(--text); }
    .statusbar .spacer { flex: 1; }

    .statusbar .badge {
      font-family: var(--mono);
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 3px;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      color: var(--accent);
      flex-shrink: 0;
    }

    /* ========= LEGEND ========= */
    .legend {
      position: fixed;
      bottom: calc(var(--statusbar-h) + 10px);
      left: 14px;
      z-index: 15;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      pointer-events: none;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      font-family: var(--mono);
      color: var(--text-dim);
    }

    .legend-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
    }

    /* ========= TOOLTIP ========= */
    .tooltip {
      position: fixed;
      z-index: 100;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 8px 12px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.1s;
      max-width: 240px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.4);
    }

    .tooltip.visible { opacity: 1; }

    .tooltip .tt-tag {
      font-family: var(--mono);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 2px;
    }

    .tooltip .tt-name {
      font-weight: 600;
      font-size: 13px;
      color: var(--text);
    }

    .tooltip .tt-props {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-dim);
      line-height: 1.5;
      white-space: pre-line;
    }

    /* ========= MODALS ========= */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-card {
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      width: 380px;
      box-shadow: 0 16px 48px rgba(0,0,0,0.5);
      overflow: hidden;
    }

    .modal-head {
      padding: 12px 16px;
      background: var(--bg-darker);
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-head .close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 18px;
      cursor: pointer;
      padding: 2px;
      line-height: 1;
    }

    .modal-head .close:hover { color: var(--text); }

    .modal-body {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .modal-body label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .modal-body input, .modal-body select {
      font-family: var(--font);
      font-size: 13px;
      padding: 7px 10px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg-darker);
      color: var(--text);
      outline: none;
      transition: border-color 0.15s;
    }

    .modal-body input:focus, .modal-body select:focus { border-color: var(--accent); }

    .modal-foot {
      padding: 10px 16px;
      background: var(--bg-darker);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .modal-foot button {
      font-family: var(--font);
      font-size: 12px;
      font-weight: 500;
      padding: 6px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.12s;
    }

    .btn-cancel {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-dim);
    }
    .btn-cancel:hover { color: var(--text); border-color: var(--text-dim); }

    .btn-save {
      background: var(--green);
      border: 1px solid var(--green);
      color: #fff;
    }
    .btn-save:hover { filter: brightness(1.1); }

    .btn-danger {
      background: var(--red);
      border: 1px solid var(--red);
      color: #fff;
    }
    .btn-danger:hover { filter: brightness(1.1); }

    .field-row {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    /* Fallback */
    .fallback {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: var(--bg);
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px;
    }
    .fallback.visible { display: flex; }
    .fallback h2 { font-family: var(--mono); font-size: 18px; color: var(--red); margin-bottom: 10px; }
    .fallback p { color: var(--text-dim); max-width: 380px; line-height: 1.6; font-size: 14px; }
  </style>
</head>
<body>
  <div id="app">
    <!-- TOOLBAR -->
    <div class="toolbar">
      <div class="brand"><span class="dot"></span> graphGPU</div>
      <div class="sep"></div>
      <button class="btn" :class="{ active: layoutRunning }" @click="toggleLayout">
        <i :class="layoutRunning ? 'ph-pause-bold' : 'ph-play-bold'"></i>
        {{ layoutRunning ? 'pause' : 'layout' }}
      </button>
      <button class="btn" @click="fitView"><i class="ph-arrows-out-bold"></i> fit</button>
      <button class="btn" @click="resetGraph"><i class="ph-arrow-counter-clockwise-bold"></i> reset</button>
      <div class="sep"></div>
      <button class="btn" :class="{ active: gravityEnabled }" @click="toggleGravity">
        <i class="ph-magnet-bold"></i> pull
      </button>
      <div class="spacer"></div>
      <div class="stats"><b>{{ nodeCount }}</b> nodes · <b>{{ edgeCount }}</b> edges</div>
    </div>

    <canvas id="graph-canvas"></canvas>

    <!-- CONTEXT PANEL -->
    <div class="context-panel" :class="{ hidden: !hasSelection }">
      <div class="ctx-btn green" title="Edit node" @click="showEditModal"><i class="ph-pencil-fill"></i></div>
      <div class="ctx-btn" title="Fit to view" @click="fitView"><i class="ph-arrows-out-fill"></i></div>
      <div class="ctx-sep"></div>
      <div class="ctx-btn red" title="Delete node" @click="deleteSelected"><i class="ph-trash-fill"></i></div>
    </div>

    <!-- PALETTE BAR -->
    <div class="palette-bar">
      <div v-for="name in paletteNames" :key="name"
           class="palette-swatch"
           :class="{ active: activePalette === name }"
           :title="name"
           :style="{ background: getPalettePreview(name) }"
           @click="switchPalette(name)">
      </div>
    </div>

    <!-- LEGEND -->
    <div class="legend">
      <div class="legend-item" v-for="item in legendItems" :key="item.tag">
        <div class="legend-dot" :style="{ background: item.color }"></div>
        {{ item.tag }}
      </div>
    </div>

    <!-- STATUS BAR -->
    <div class="statusbar">
      <template v-if="selectedNode">
        <span class="tag" :style="{ background: selectedNodeColor }">{{ selectedNode.tag }}</span>
        <div class="props">
          <div class="prop" v-for="(val, key) in selectedNode.properties" :key="key">
            <b>{{ key }}:</b> <span>{{ val }}</span>
          </div>
        </div>
      </template>
      <template v-else-if="hoveredNode">
        <span class="tag" :style="{ background: hoveredNodeColor }">{{ hoveredNode.tag }}</span>
        <div class="props">
          <div class="prop" v-for="(val, key) in hoveredNode.properties" :key="key">
            <b>{{ key }}:</b> <span>{{ val }}</span>
          </div>
        </div>
      </template>
      <template v-else>
        <span style="color: var(--text-muted)">{{ nodeCount }} node{{ nodeCount !== 1 ? 's' : '' }} · {{ edgeCount }} edge{{ edgeCount !== 1 ? 's' : '' }}</span>
      </template>
      <div class="spacer"></div>
      <span class="badge">WebGPU</span>
    </div>

    <!-- TOOLTIP -->
    <div class="tooltip" :class="{ visible: tooltipVisible }" :style="tooltipStyle">
      <div class="tt-tag" :style="{ color: tooltipColor }">{{ tooltipTag }}</div>
      <div class="tt-name">{{ tooltipName }}</div>
      <div class="tt-props" v-if="tooltipProps">{{ tooltipProps }}</div>
    </div>

    <!-- EDIT MODAL -->
    <div class="modal-overlay" v-if="editModal.open" @click.self="editModal.open = false">
      <div class="modal-card">
        <div class="modal-head">
          <span>Edit Node</span>
          <button class="close" @click="editModal.open = false">&times;</button>
        </div>
        <div class="modal-body">
          <div class="field-row" v-for="(val, key) in editModal.properties" :key="key">
            <label>{{ key }}</label>
            <input v-model="editModal.properties[key]" />
          </div>
        </div>
        <div class="modal-foot">
          <button class="btn-cancel" @click="editModal.open = false">Cancel</button>
          <button class="btn-save" @click="saveEdit">Save</button>
        </div>
      </div>
    </div>

    <!-- DELETE CONFIRM -->
    <div class="modal-overlay" v-if="deleteModal.open" @click.self="deleteModal.open = false">
      <div class="modal-card">
        <div class="modal-head">
          <span>Delete Node</span>
          <button class="close" @click="deleteModal.open = false">&times;</button>
        </div>
        <div class="modal-body">
          <p style="font-size: 13px; color: var(--text-dim); line-height: 1.5;">
            Delete <b style="color: var(--text)">{{ deleteModal.label }}</b>?
            This will also remove all connected edges.
          </p>
        </div>
        <div class="modal-foot">
          <button class="btn-cancel" @click="deleteModal.open = false">Cancel</button>
          <button class="btn-danger" @click="confirmDelete">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <div class="fallback" id="fallback">
    <h2>WebGPU Not Available</h2>
    <p>This demo requires WebGPU. Try <strong>Chrome 113+</strong>, <strong>Edge 113+</strong>, or <strong>Safari 18+</strong>.</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
  <script type="module">
    import { GraphGPU } from 'graphgpu';

    const { createApp, ref, reactive, computed, onMounted } = Vue;

    createApp({
      setup() {
        let g = null;
        const layoutRunning = ref(true);
        const gravityEnabled = ref(false);
        const activePalette = ref('vibrant');
        const nodeCount = ref(0);
        const edgeCount = ref(0);
        const selectedNode = ref(null);
        const selectedNodeId = ref(null);
        const selectedNodeColor = ref('#888');
        const hoveredNode = ref(null);
        const hoveredNodeColor = ref('#888');
        const tooltipVisible = ref(false);
        const tooltipStyle = ref({});
        const tooltipTag = ref('');
        const tooltipName = ref('');
        const tooltipProps = ref('');
        const tooltipColor = ref('#888');
        const editModal = reactive({ open: false, nodeId: null, properties: {} });
        const deleteModal = reactive({ open: false, nodeId: null, label: '' });
        const legendItems = ref([]);

        const nodeTypeTags = ['person', 'movie', 'country', 'book'];
        const paletteNames = ['default', 'vibrant', 'pastel', 'earthy', 'inferno', 'playful', 'viridis', 'rainbow'];
        const tagColorCache = {};

        const hasSelection = computed(() => selectedNode.value !== null);

        function getTagHex(bg) {
          return `rgb(${Math.round(bg[0]*255)},${Math.round(bg[1]*255)},${Math.round(bg[2]*255)})`;
        }

        function refreshLegend() {
          if (!g) return;
          const items = [];
          for (const [tag, { bg }] of g.getTagColors()) {
            const hex = getTagHex(bg);
            tagColorCache[tag] = hex;
            if (nodeTypeTags.includes(tag)) items.push({ tag, color: hex });
          }
          legendItems.value = items;
        }

        function updateCounts() {
          if (!g) return;
          nodeCount.value = g.nodeCount;
          edgeCount.value = g.edgeCount;
        }

        function getNodeLabel(node) {
          return (node.properties.name ?? node.properties.title ?? node.tag);
        }

        function getPalettePreview(name) {
          return GraphGPU.palettes[name]?.colors?.[0] ?? '#666';
        }

        function toggleLayout() {
          if (!g) return;
          if (layoutRunning.value) { g.stopLayout(); layoutRunning.value = false; }
          else { g.startLayout({ repulsion: 1.2, attraction: 0.015, gravity: 0.12 }); layoutRunning.value = true; }
        }

        function fitView() { g?.fitView(0.15); }

        function resetGraph() {
          if (!g) return;
          if (layoutRunning.value) g.stopLayout();
          g.resetPositions();
          g.startLayout({ repulsion: 1.2, attraction: 0.015, gravity: 0.12, damping: 0.9, maxIterations: 400 });
          layoutRunning.value = true;
          g.resetView();
          setTimeout(() => g.fitView(0.15), 1500);
        }

        function toggleGravity() {
          gravityEnabled.value = !gravityEnabled.value;
          g?.setGravityPull(gravityEnabled.value, 0.15);
        }

        function switchPalette(name) {
          activePalette.value = name;
          g?.setPalette(name);
          refreshLegend();
        }

        function showEditModal() {
          if (!g || selectedNodeId.value === null) return;
          const node = g.getGraph().getNode(selectedNodeId.value);
          if (!node) return;
          editModal.nodeId = selectedNodeId.value;
          editModal.properties = { ...node.properties };
          editModal.open = true;
        }

        function saveEdit() {
          if (!g || editModal.nodeId === null) return;
          const graph = g.getGraph();
          for (const [key, val] of Object.entries(editModal.properties)) {
            graph.setNodeProperty(editModal.nodeId, key, val);
          }
          const updated = graph.getNode(editModal.nodeId);
          if (updated) selectedNode.value = { ...updated };
          editModal.open = false;
          updateCounts();
        }

        function deleteSelected() {
          if (!g || selectedNodeId.value === null) return;
          const node = g.getGraph().getNode(selectedNodeId.value);
          if (!node) return;
          deleteModal.nodeId = selectedNodeId.value;
          deleteModal.label = getNodeLabel(node);
          deleteModal.open = true;
        }

        function confirmDelete() {
          if (!g || deleteModal.nodeId === null) return;
          g.unput(deleteModal.nodeId);
          selectedNode.value = null;
          selectedNodeId.value = null;
          deleteModal.open = false;
          updateCounts();
        }

        onMounted(async () => {
          const canvas = document.getElementById('graph-canvas');
          const fallback = document.getElementById('fallback');

          g = new GraphGPU({
            canvas,
            palette: 'vibrant',
            nodeSize: 5,
            edgeOpacity: 0.7,
            antialias: true,
            background: [0.118, 0.122, 0.149, 1],
            interaction: { pan: true, zoom: true, dragNodes: true, hover: true, selection: true, multiSelect: false },
          });

          const ok = await g.init();
          if (!ok) { fallback.classList.add('visible'); return; }

          const graph = g.getGraph();
          graph.tagColors.setColor('person', '#ff6b6b');
          graph.tagColors.setColor('movie', '#ffd93d');
          graph.tagColors.setColor('country', '#6bcb77');
          graph.tagColors.setColor('book', '#4d96ff');

          // ── Cinema data ──
          const uk=g.put('country',{name:'United Kingdom'}),au=g.put('country',{name:'Australia'}),us=g.put('country',{name:'United States'}),ca=g.put('country',{name:'Canada'}),fr=g.put('country',{name:'France'}),de=g.put('country',{name:'Germany'}),se=g.put('country',{name:'Sweden'}),es=g.put('country',{name:'Spain'}),pl=g.put('country',{name:'Poland'});
          const nolan=g.put('person',{name:'Christopher Nolan',birthday:1970}),pearce=g.put('person',{name:'Guy Pearce',birthday:1967}),hanson=g.put('person',{name:'Curtis Hanson',birthday:1945}),spacey=g.put('person',{name:'Kevin Spacey',birthday:1959}),dicaprio=g.put('person',{name:'Leonardo DiCaprio',birthday:1974}),hardy=g.put('person',{name:'Tom Hardy',birthday:1977}),cotillard=g.put('person',{name:'Marion Cotillard',birthday:1975}),moss=g.put('person',{name:'Carrie-Ann Moss',birthday:1967}),kidman=g.put('person',{name:'Nicole Kidman',birthday:1967}),cruise=g.put('person',{name:'Tom Cruise',birthday:1962}),kubrick=g.put('person',{name:'Stanley Kubrick',birthday:1928,died:1999}),burton=g.put('person',{name:'Tim Burton',birthday:1958}),depp=g.put('person',{name:'Johnny Depp',birthday:1965}),hallstrom=g.put('person',{name:'Lasse Hallström',birthday:1946}),scorsese=g.put('person',{name:'Martin Scorsese',birthday:1942}),sydow=g.put('person',{name:'Max von Sydow',birthday:1929,died:2020}),binoche=g.put('person',{name:'Juliette Binoche',birthday:1964}),dench=g.put('person',{name:'Judi Dench',birthday:1934}),eastwood=g.put('person',{name:'Clint Eastwood',birthday:1930}),polanski=g.put('person',{name:'Roman Polanski',birthday:1933}),olin=g.put('person',{name:'Lena Olin',birthday:1955}),zimmer=g.put('person',{name:'Hans Zimmer',birthday:1957}),pook=g.put('person',{name:'Jocelyn Pook',birthday:1960}),lehane=g.put('person',{name:'Dennis Lehane',birthday:1965}),penn=g.put('person',{name:'Sean Penn',birthday:1960}),malick=g.put('person',{name:'Terrence Malick',birthday:1943}),brody=g.put('person',{name:'Adrien Brody',birthday:1973}),wach1=g.put('person',{name:'Lana Wachowski',birthday:1965}),wach2=g.put('person',{name:'Lilly Wachowski',birthday:1967});
          const memento=g.put('movie',{title:'Memento',year:2000}),inception=g.put('movie',{title:'Inception',year:2010}),laconfidential=g.put('movie',{title:'L.A. Confidential',year:1997}),matrix=g.put('movie',{title:'The Matrix',year:1999}),eyes=g.put('movie',{title:'Eyes Wide Shut',year:1999}),bigfish=g.put('movie',{title:'Big Fish',year:2003}),sleepyhollow=g.put('movie',{title:'Sleepy Hollow',year:1999}),chocolat=g.put('movie',{title:'Chocolat',year:2000}),jedgar=g.put('movie',{title:'J. Edgar',year:2011}),ninthgate=g.put('movie',{title:'The Ninth Gate',year:1999}),shutter=g.put('movie',{title:'Shutter Island',year:2010}),mystic=g.put('movie',{title:'Mystic River',year:2003}),redline=g.put('movie',{title:'Thin Red Line',year:1998}),pianist=g.put('movie',{title:'The Pianist',year:2002});
          const mysticB=g.put('book',{title:'Mystic River',year:2001,language:'en'});

          g.link([nolan,hardy,dench,pook],'isFrom',uk);
          g.link([pearce,kidman],'isFrom',au);
          g.link([malick,brody,hanson,spacey,dicaprio,wach1,wach2,cruise,kubrick,burton,depp,eastwood,scorsese,lehane,penn],'isFrom',us);
          g.link(moss,'isFrom',ca);g.link([cotillard,binoche],'isFrom',fr);
          g.link(polanski,'isFrom',[fr,pl]);g.link([hallstrom,olin,sydow],'isFrom',se);g.link(zimmer,'isFrom',de);
          g.link(nolan,'directed',[memento,inception]);g.link(hanson,'directed',laconfidential);g.link([wach1,wach2],'directed',matrix);g.link(kubrick,'directed',eyes);g.link(burton,'directed',[bigfish,sleepyhollow]);g.link(hallstrom,'directed',chocolat);g.link(eastwood,'directed',[jedgar,mystic]);g.link(polanski,'directed',[pianist,ninthgate]);g.link(scorsese,'directed',shutter);g.link(malick,'directed',[pianist,redline]);
          g.link(pearce,'actedIn',[memento,laconfidential]);g.link(spacey,'actedIn',laconfidential);g.link([dicaprio,hardy,cotillard],'actedIn',inception);g.link([dicaprio,sydow],'actedIn',shutter);g.link(cotillard,'actedIn',bigfish);g.link(moss,'actedIn',[memento,matrix,chocolat]);g.link([cruise,kidman],'actedIn',eyes);g.link(depp,'actedIn',[chocolat,sleepyhollow]);g.link([binoche,dench,olin],'actedIn',chocolat);g.link([dicaprio,dench],'actedIn',jedgar);g.link([depp,olin],'actedIn',ninthgate);g.link(penn,'actedIn',[mystic,redline]);g.link(brody,'actedIn',[redline,pianist]);
          g.link(zimmer,'composed',inception);g.link(pook,'composed',eyes);g.link(nolan,'written',inception);g.link(lehane,'written',mysticB);g.link(mystic,'basedOn',mysticB);g.link(wach1,'sibling',wach2);g.link(cruise,'married',kidman);

          g.startLayout({ repulsion: 1.2, attraction: 0.015, gravity: 0.12, damping: 0.9, maxIterations: 400 });
          setTimeout(() => g.fitView(0.15), 1500);
          updateCounts();
          refreshLegend();

          // ── Events ──
          g.on('node:hover', (e) => {
            const node = e.target; if (!node) return;
            hoveredNode.value = { ...node };
            hoveredNodeColor.value = tagColorCache[node.tag] ?? '#888';
            tooltipTag.value = node.tag;
            tooltipName.value = getNodeLabel(node);
            tooltipColor.value = tagColorCache[node.tag] ?? '#888';
            tooltipProps.value = Object.entries(node.properties).filter(([k])=>k!=='name'&&k!=='title').map(([k,v])=>`${k}: ${v}`).join('\n');
            tooltipVisible.value = true;
          });
          g.on('node:hoverout', () => { hoveredNode.value = null; tooltipVisible.value = false; });
          g.on('node:select', (e) => {
            const node = e.target; if (!node) return;
            selectedNode.value = { ...node }; selectedNodeId.value = node.id;
            selectedNodeColor.value = tagColorCache[node.tag] ?? '#888';
          });
          g.on('node:deselect', () => { selectedNode.value = null; selectedNodeId.value = null; });

          canvas.addEventListener('mousemove', (e) => {
            tooltipStyle.value = { left: `${e.clientX+14}px`, top: `${e.clientY-8}px` };
          });

          window.addEventListener('resize', () => g.resize());
          window.g = g;
        });

        return {
          layoutRunning, gravityEnabled, activePalette, nodeCount, edgeCount,
          selectedNode, selectedNodeColor, hoveredNode, hoveredNodeColor, hasSelection,
          tooltipVisible, tooltipStyle, tooltipTag, tooltipName, tooltipProps, tooltipColor,
          legendItems, paletteNames,
          editModal, deleteModal,
          toggleLayout, fitView, resetGraph, toggleGravity,
          switchPalette, getPalettePreview,
          showEditModal, saveEdit, deleteSelected, confirmDelete,
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
